# topコマンド

topコマンドを利用すると、その計算機で動作しているプログラムのうち、どれがCPU時間を消費しているかや、
どれがメモリを占有しているかを確認できます。

以下のように呼び出します。
```
top
```
以下のように表示されます。
```top - 14:57:55 up 71 days,  5:13,  4 users,  load average: 0.01, 0.02, 0.05
Tasks: 734 total,   1 running, 733 sleeping,   0 stopped,   0 zombie
%Cpu(s):  0.1 us,  0.2 sy,  0.0 ni, 99.7 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
KiB Mem : 52808937+total, 45810416+free,  7178816 used, 62806404 buff/cache
KiB Swap:  4194300 total,  3951808 free,   242492 used. 51950041+avail Mem

  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND
12943 sequser   20   0  162792   2728   1544 R  11.8  0.0   0:00.04 top
    1 root      20   0  191796   3544   1768 S   0.0  0.0   5:35.21 systemd
    2 root      20   0       0      0      0 S   0.0  0.0   0:03.20 kthreadd
    4 root       0 -20       0      0      0 S   0.0  0.0   0:00.00 kworker/0:0H
    6 root      20   0       0      0      0 S   0.0  0.0   0:09.53 ksoftirqd/0
    7 root      rt   0       0      0      0 S   0.0  0.0   0:22.46 migration/0
```

topの表示の上の方はサマリー情報で、大事な項目の見方は覚えておきましょう。
- load average
  - 右上に3つ小数が表示されており、左から順に直近1分間、5分間、15分間の計算機の負荷(load)が表示されています。
- KiB Mem
  - この計算機の物理メモリ量が表示されています。この例では桁が表示しきれず切れていますが約512GBです。

メモリの現在の使用量なども表示されていますが、性能を低下させる要因をここから読み取るのは現在のLinuxでは難しくなってしまったので、ここでは説明は割愛します。

topコマンドで下の方はタスクエリアと呼ばれるタスクの一覧です。タスクというのは、単純な状況ではタスク＝プロセス＝ジョブという状況です。
実行中のプログラムをどの視点で見るかによって呼称が変わるようですが、ユーザ vs OSの図式の中で、プロセスというのが最も意味が厳密で
OS上で動作するプログラムの基本的な実行単位です。
ジョブというのはシェルやSGEのようなジョブスケジューラがプロセスを指してそのように呼び、一般的にはジョブはユーザに近い見方で、
プロセスはOSに近い見方なので、ジョブの方はユーザのコマンドやソフトウェアによってキューイング(待ち)されたり、Ctrl-Zでサスペンドされたり、
fgコマンドで再開されたりします。タスクという言葉はOSの用語としてはプロセスほど厳密な意味は持たないようですが、OS側から見たプロセスやジョブのことを指します。
```man pidstat```などの説明を読むとタスクという言葉が好んで使われているようです。

タスクエリアに表示されている内容を確認していきましょう
- PID
  - Process IDの略です。killコマンドや、pidstatなど様々なコマンドで利用できるIDなので重要です。
- USER
  - そのプログラムを実行しているユーザアカウント名です
- PR
  - Priorityです。デフォルトの優先度は20で、最高の0から最低の39まであります。rootであればreniceコマンドで上げ下げは自由で
    一般のユーザは下げることしかできません。コマンドの実行時にniceコマンドで指定することもできます。
- NI
  - nice値と呼ばれる優先度の調整値で、nice -n 10 [コマンド] として実行した場合にここに10と表示され、PRはnice値を合計された30という
    低い優先度での実行になります。
- VIRT
  - 仮想メモリ容量です。スワップアウトしてHDDなどのスワップ領域に追い出された領域の容量も含みます。
- RES
  - Resident Memory Sizeのことで、実際の物理メモリの使用量です。これは非常に重要で何かあった際は見ておかなければなりません。
- SHR
  - Shared memory Sizeでプロセス間の通信に使用する共有メモリのサイズです。
- S
  - Process Statusで、プロセスの状態を示します。1文字のアルファベットの意味は下記の表を参照してください。
- %CPU
  - CPU使用率です。これも重要です。2コアをフル回転させると200%になります。
- %MEM
  - メモリ使用率です。
- TIME
  - CPU時間、つまりCPUを使用した時間の累積値です。マルチスレッドで2コアを1時間使うとCPU時間は2時間になります。CPU+の場合は秒単位で表示されます。
- COMMAND
  - そのプロセスのコマンドとしての表記です

## Process Status
|Status | 意味 |
| ------------- | ------------- |
| D | uninterruptible sleep|
| R | running |
| S | sleeping|
| T | stopped by job control signal|
| t | stopped by debugger during trace|
| Z | zombie|
